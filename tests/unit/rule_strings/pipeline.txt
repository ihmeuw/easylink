from linker.utilities import validation_utils
rule all:
    input:
        final_output=['{snake_dir}/result.parquet'],
        validation='{snake_dir}/input_validations/final_validator'
rule:
    name: "results_validator"
    input: ['{snake_dir}/result.parquet']
    output: touch("{snake_dir}/input_validations/final_validator")
    localrule: True         
    message: "Validating results input"
    run:
        for f in input:
            validation_utils.validate_input_file_dummy(f)
rule:
    name: "step_1_python_pandas_validator"
    input: ['{test_dir}/input_data1/file1.csv', '{test_dir}/input_data2/file2.csv']
    output: touch("{snake_dir}/input_validations/step_1_python_pandas_validator")
    localrule: True         
    message: "Validating step_1_python_pandas input"
    run:
        for f in input:
            validation_utils.validate_input_file_dummy(f)
rule:
    name: "step_1_python_pandas"
    input:
        implementation_inputs=['{test_dir}/input_data1/file1.csv', '{test_dir}/input_data2/file2.csv'],
        validation="{snake_dir}/input_validations/step_1_python_pandas_validator"
    output: ['{snake_dir}/intermediate/1_step_1/result.parquet']
    shell:
        '''
        export DUMMY_CONTAINER_MAIN_INPUT_FILE_PATHS={test_dir}/input_data1/file1.csv,{test_dir}/input_data2/file2.csv
        export DUMMY_CONTAINER_OUTPUT_PATHS={snake_dir}/intermediate/1_step_1/result.parquet
        export DUMMY_CONTAINER_DIAGNOSTICS_DIRECTORY={snake_dir}/diagnostics/1_step_1
        python src/linker/steps/dev/python_pandas/dummy_step.py
        '''
rule:
    name: "step_2_python_pandas_validator"
    input: ['{snake_dir}/intermediate/1_step_1/result.parquet']
    output: touch("{snake_dir}/input_validations/step_2_python_pandas_validator")
    localrule: True         
    message: "Validating step_2_python_pandas input"
    run:
        for f in input:
            validation_utils.validate_input_file_dummy(f)
rule:
    name: "step_2_python_pandas"
    input:
        implementation_inputs=['{snake_dir}/intermediate/1_step_1/result.parquet'],
        validation="{snake_dir}/input_validations/step_2_python_pandas_validator"
    output: ['{snake_dir}/result.parquet']
    shell:
        '''
        export DUMMY_CONTAINER_MAIN_INPUT_FILE_PATHS={snake_dir}/intermediate/1_step_1/result.parquet
        export DUMMY_CONTAINER_OUTPUT_PATHS={snake_dir}/result.parquet
        export DUMMY_CONTAINER_DIAGNOSTICS_DIRECTORY={snake_dir}/diagnostics/2_step_2
        python src/linker/steps/dev/python_pandas/dummy_step.py
        '''